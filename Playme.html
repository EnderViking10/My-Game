<!DOCTYPE html>
<html>

<head>
   <meta charset="UTF-8">
   <title>Game</title>
   <script>
	var canvas;
	var c;
	var midx,midy,cw,ch;
	var pi = Math.PI;
	var players;
	var guy,guard;
	var xL = 125,xR = xL;
	var xpos = [250*Math.random() + 1,250*Math.random() + 1,250*Math.random() + 1,250*Math.random() + 1];
	var ypos = [0,-200,-400,-600];
	var x2pos = [250*Math.random() + 1,250*Math.random() + 1,250*Math.random() + 1,250*Math.random() + 1];
	var y2pos = [0,-200,-400,-600];
	var random;
	var buttons = [];
	var axes = [];
	var scalexL,scalexR;
	var scaleyL,scaleyR;
	var yL,yR;
	var score = 0,count = 0;
	var music1,music2;
	var hscore = 0;
	var p = 0, k = 0;
	var x1;
	var lost = 0;
	var mobile = 0;
	
    function initialize() {
        canvas = document.getElementById( "canvas" );
        if ( canvas && canvas.getContext ) {
            c = canvas.getContext( "2d" );
			
			window.addEventListener("keydown", keystroke);
			canvas.addEventListener("mouseup", mouseUp);
			window.addEventListener("gamepadconnected", function(e){
				console.log(e.gamepad.index);
				k = 1;
			});
			window.addEventListener("gamepaddisconnected", function(e){
				console.log(e.gamepad.index);
				k = 0;
			});
			
			music1 = document.getElementById("music1");
			music2 = document.getElementById("music2");
			
			// Center of screen
			
			midx = canvas.width/2;
			midy = canvas.height/2;
			cw = canvas.width;
			ch = canvas.height;
			
			yL = midy;
			yR = midy;
			
			do{
				players = parseInt(prompt("Enter the number of players"));
			}while(players != 1 && players != 2);
		
			guy = document.getElementById("guy");
			guard = document.getElementById("guard");
			
			window.setInterval("drawScreen()",1000/60);  // call repeatedly
			
        } // end if
    } // initialize()
	  
	function drawScreen(e){
		
		if(k == 1)
			buttonPress();
		
	  // Background
	  
		c.beginPath();
		c.fillStyle = "white";
		c.fillRect(0,0, canvas.width, canvas.height);
		c.closePath();	
	
	  // Does score
		
		c.beginPath();
		c.font = "15pt Arial";
		c.textAlign = "left";
		c.textBaseline = "top";
		c.fillStyle = "black";
		c.fillText("score: " + score,0,0);
		c.closePath();
		
	  // Draws buttons for music
		
		if(players == 1){
			x1 = 720;
		}
		else{
			x1 = 820;
		}
		
		c.textAlign = "center";
		c.textBaseline = "middle";
		
		// Start button
		c.beginPath();
		c.fillStyle = "lightgrey";
		c.strokeStyle = "grey";
		c.lineWidth = 5;
		c.rect(x1,5,75,75);
		c.fill();
		c.stroke();
		c.closePath();
		
		c.beginPath();
		c.fillStyle = "black";
		c.fillText("SNA",x1 + 37,37);
		c.closePath();
		
		// Stop button
		c.beginPath();
		c.fillStyle = "lightgrey";
		c.strokeStyle = "grey";
		c.lineWidth = 5;
		c.rect(x1,160,75,75);
		c.fill();
		c.stroke();
		c.closePath();
		
		c.beginPath();
		c.fillStyle = "black";
		c.fillText("FS",x1 + 37,197);
		c.closePath();
		
	  // Draws movement buttons
		
		if(players == 1){
			if(mobile != 1){
				c.fillStyle = "black";
				c.beginPath();
				c.fillRect(480,250,50,50);
				c.closePath();
			}
			if(mobile == 1){
				c.fillStyle = "black";
				c.beginPath();
				c.fillRect(450,400,50,50);
				c.fillRect(510,400,50,50);
				c.fillRect(480,340,50,50);
				c.fillRect(480,460,50,50);
				c.closePath();
			}
		}
		
		if(players == 1)
			onePlayer();
		else if(players == 2)
			twoPlayers();
	}

	/*
	Does both players hitboxes
	*/

  // Does one player hitboxs
  
	function onePlayer() {
		
		if(k == 1){
			gamePadUpdate();
		}
	  // Draws "hitboxes"
		if(xpos[0] < xL + 39 && xpos[0] + 39 > xL && ypos[0] < yL + 49 && ypos[0] + 49 > yL){
			leftLost();
		}else if(xpos[1] < xL + 39 && xpos[1] + 39 > xL && ypos[1] < yL + 49 && ypos[1] + 49 > yL){
			leftLost();
		}else if(xpos[2] < xL + 39 && xpos[2] + 39 > xL && ypos[2] < yL + 49 && ypos[2] + 49 > yL){
			leftLost();
		}else if(xpos[3] < xL + 39 && xpos[3] + 39 > xL && ypos[3] < yL + 49 && ypos[3] + 49 > yL){
			leftLost();
		}else{
			leftPlayer();
			count++;
			if(count == 60){
				score++;
				count = 0;
			}
		}
	}
	  	  
  // Does two players hitboxes
		  
	function twoPlayers() {
		
		if(k == 1){
			gamePadUpdate();
		}
	  // Draws "hitboxes"
		if(xpos[0] < xL + 39 && xpos[0] + 39 > xL && ypos[0] < yL + 49 && ypos[0] + 49 > yL){
			leftLost();
		}else if(xpos[1] < xL + 39 && xpos[1] + 39 > xL && ypos[1] < yL + 49 && ypos[1] + 49 > yL){
			leftLost();
		}else if(xpos[2] < xL + 39 && xpos[2] + 39 > xL && ypos[2] < yL + 49 && ypos[2] + 49 > yL){
			leftLost();
		}else if(xpos[3] < xL + 39 && xpos[3] + 39 > xL && ypos[3] < yL + 49 && ypos[3] + 49 > yL){
			leftLost();
		}else if(x2pos[0] < xR + 39 && x2pos[0] + 39 > xR && y2pos[0] < yR + 49 && y2pos[0] + 49 > yR){
			rightLost();
		}else if(x2pos[1] < xR + 39 && x2pos[1] + 39 > xR && y2pos[1] < yR + 49 && y2pos[1] + 49 > yR){
			rightLost();
		}else if(x2pos[2] < xR + 39 && x2pos[2] + 39 > xR && y2pos[2] < yR + 49 && y2pos[2] + 49 > yR){
			rightLost();
		}else if(x2pos[3] < xR + 39 && x2pos[3] + 39 > xR && y2pos[3] < yR + 49 && y2pos[3] + 49 > yR){
			rightLost();
		}else{
			rightPlayer();
			leftPlayer();
			count++;
			if(count == 60){
				score++;
				count = 0;
			}
		}
	}
	
	/*
	Does both players
	*/
	
  // Does left player
	
	function leftPlayer(){
		
		axesMove();
		
	  // Translates
		c.save();
		c.translate(100,0);
		
	  // Draws road
		
		c.beginPath();
		c.fillStyle = "black";
		c.fillRect(0,0,300,ch);
		c.closePath();
		
	  // Draws character
		
		c.drawImage(guy,xL,yL);
		
	  // Draws guards
		
		c.drawImage(guard,xpos[0],ypos[0]);
		c.drawImage(guard,xpos[1],ypos[1]);
		c.drawImage(guard,xpos[2],ypos[2]);
		c.drawImage(guard,xpos[3],ypos[3]);
	  
	  // Moves guards down
		
		ymove = score*.1;
		
		for(var i = 0; i < 3; i++){
			if(score < 20)
				ypos[i] += 2;
			else
				ypos[i] += ymove;
		}
		
	  // Moves guards to top
		
		random = 250*Math.random() + 1;
		
		if(ypos[0] > ch){
			ypos[0] = 0;
			xpos[0] = random;
		}
		if(ypos[1] > ch){
			ypos[1] = 0;
			xpos[1] = random;
		}
		if(ypos[2] > ch){
			ypos[2] = 0;
			xpos[2] = random;
		}
		if(ypos[3] > ch){
			ypos[3] = 0;
			xpos[3] = random;
		}
		
		if(xL < 0)
			xL = 0;
		if(xL > 250)
			xL = 250;
		if(yL < 0)
			yL = 0;
		if(yL > 551)
			yL = 551;
		
		c.restore();
	}
	
  // Does right player
	
	function rightPlayer(){
		
		axesMove();
		
	  // Translates
		c.save();
		c.translate(500,0);
		
	  // Draws road
		
		c.beginPath();
		c.fillStyle = "black";
		c.fillRect(0,0,300,ch);
		c.closePath();
		
	  // Draws character
		
		c.drawImage(guy,xR,yR);
		
	  // Draws guards
		
		c.drawImage(guard,x2pos[0],y2pos[0]);
		c.drawImage(guard,x2pos[1],y2pos[1]);
		c.drawImage(guard,x2pos[2],y2pos[2]);
		c.drawImage(guard,x2pos[3],y2pos[3]);
	  
	  // Moves guards down
		
		for(var i = 0; i < 3; i++){
			if(score < 20)
				y2pos[i] += 2;
			else
				y2pos[i] += score*.1;
		}
		
	  // Moves guards to top
		
		random = 250*Math.random() + 1;
		
		if(y2pos[0] > ch){
			y2pos[0] = 0;
			x2pos[0] = random;
		}
		if(y2pos[1] > ch){
			y2pos[1] = 0;
			x2pos[1] = random;
		}
		if(y2pos[2] > ch){
			y2pos[2] = 0;
			x2pos[2] = random;
		}
		if(y2pos[3] > ch){
			y2pos[3] = 0;
			x2pos[3] = random;
		}
		
		if(xR < 0)
			xR = 0;
		if(xR > 250)
			xR = 250;
		if(yR < 0)
			yR = 0;
		if(yR > 551)
			yR = 551;
		
		c.restore();
	}
	
	/*
	Does loosing
	*/
	
  // Left loosing
	
	function leftLost(){
		
	  // Draws stuff
		
		c.beginPath();
		c.fillStyle = "black";
		c.fillRect(0,0,cw,ch);
		c.closePath();
		
		c.textAlign = "center";
		c.textBaseline = "middle";
		c.font = "24pt bold Comic Sans MS";
		c.lineWidth = 1;
		
		c.beginPath();
		c.fillStyle = "red";
		c.fillText("Player 1 is a loser", midx,midy);
		c.closePath();
		if(players == 1){
			if(score > hscore)
				hscore = score;
			
			c.beginPath();
			c.strokeStyle = "red";
			c.strokeText("Your score is " + score, midx,400);
			c.strokeText("The highscore is " + hscore,midx,500);
			c.closePath();
		}
		
		music1.pause();
		music2.pause();
		music1.currentTime = 0;
		music2.currentTime = 0;
		
		lost = 1;
	}
	
  // Right loosing
	
	function rightLost(){
		
	  // Draws stuff
		
		c.beginPath();
		c.fillStyle = "black";
		c.fillRect(0,0,cw,ch);
		c.closePath();
		
		c.beginPath();
		c.textAlign = "center";
		c.textBaseline = "middle";
		c.lineWidth = 1;
		c.font = "24pt bold Comic Sans MS";
		c.fillStyle = "red";
		c.fillText("Player 2 is a loser", midx,midy);
		c.closePath();
		
		music1.pause();
		music2.pause();
		music1.currentTime = 0;
		music2.currentTime = 0;
		
		lost = 1;
	}
	
	/*
	Keyboard inputs
	*/
	
	function keystroke(key){
		if(lost != 1){
			switch(key.keyCode){
				case 65: // Moves left LP
					xL -= 10;
					break;
				case 68: // Moves right LP
					xL += 10;
					break;
				case 87: // Moves up LP
					yL -= 10;
					break;
				case 83: // Moves down LP
					yL += 10;
					break;
				case 37: // Moves left RP
					xR -= 10;
					break;
				case 39: // Moves right RP
					xR += 10;
					break;
				case 38: // Moves up RP
					yR -= 10;
					break;
				case 37: // Moves down LRP
					yR += 10;
					break;
			}
		}
		switch(key.keyCode){
			case 82: // Resets
				score = 0;
				count = 0;
				lost = 0;
				xpos = [250*Math.random() + 1,250*Math.random() + 1,250*Math.random() + 1,250*Math.random() + 1];
				ypos = [-150,-300,-450,-600];
				x2pos = [250*Math.random() + 1,250*Math.random() + 1,250*Math.random() + 1,250*Math.random() + 1];
				y2pos = [-150,-300,-450,-600];
				xL = 150;
				yL = midy;
				xR = 150;
				yR = midy;
				if(p == 1)
					music1.play();
				if(p == 2)
					music2.play();
				break;
			}		
	}
	
	/*
	Controller inputs
	*/
	
	function gamePadUpdate(){
		var gamepads = navigator.getGamepads();
		if(gamepads && gamepads.length > 0){
			var gamepad = gamepads[0];
			buttons = [];   
			for (var i = 0; i < gamepad.buttons.length; i++){
				buttons[i] = gamepad.buttons[i].pressed;
			}	
			axes = [];
			for (var i = 0; i < gamepad.axes.length; i++){
				axes[i] = gamepad.axes[i];
			}
		}
	}
	
	function buttonPress(){
		if(buttons.length > 9){
			if(buttons[9] == true){
				score = 0;
				count = 0;
				xpos = [250*Math.random() + 1,250*Math.random() + 1,250*Math.random() + 1,250*Math.random() + 1];
				ypos = [-150,-300,-450,-600];
				x2pos = [250*Math.random() + 1,250*Math.random() + 1,250*Math.random() + 1,250*Math.random() + 1];
				y2pos = [-150,-300,-450,-600];
				xL = 150;
				yL = midy;
				xR = 150;
				yR = midy;
				if(p == 1)
					music1.play();
				if(p == 2)
					music2.play();
			}
		}
	}
	
	function axesMove(){
		if(axes.length > 0){
			if(axes[0] > .05 || axes[0] < -.05){
				scalexL = axes[0];
				xL += scalexL*3;
			}
		}
		if(axes.length > 1){
			if(axes[1] > .05 || axes[1] < -.05){
				scaleyL = axes[1];
				yL += scaleyL*3;
			}
		}
		if(axes.length > 2){
			if(axes[2] > .05 || axes[2] < -.05){
				scalexR = axes[2]
				xR += scalexR*3;
			}
		}
		if(axes.length > 3){
			if(axes[3] > .05 || axes[3] < -.05){
				scaleyR = axes[3];
				yR += scaleyR*3;
			}
		}
	}
	
	/*
	Mouse input
	*/
	
	function mouseUp(mouse){
		var myX = mouse.pageX - canvas.offsetLeft;
		var myY = mouse.pageY - canvas.offsetTop;
	
	  // Plays seven nations army
		if(myX > x1 && myX < x1 + 75 && myY > 5 && myY < 80){
			if(p != 2){
				music1.play();
				p = 1;
			}
		}
	  // Plays fortunate son
		if(myX > x1 && myX < x1 + 75 && myY > 160 && myY < 235){
			if(p != 1){
				music2.play();
				p = 2;
			}
		}
	  // Adds mobile controls
		if(myX > 480 && myX < 530 && myY > 240 && myY < 290){
			mobile = 1;
		}
		if(mobile == 1){
		  // Moves left
			if(myX > 450 && myX < 500 && myY > 400 && myY < 450){
				xL -= 10;
			}
		  // Moves right
			if(myX > 510 && myX < 560 && myY > 400 && myY < 450){
				xL += 10;
			}
		  // Moves up
			if(myX > 480 && myX < 530 && myY > 340 && myY < 390){
				yL -= 10;
			}
		  // Moves down
			if(myX > 480 && myX < 530 && myY > 460 && myY < 510){
				yL += 10;
			}
		}
	}
   </script>
</head>

<body onload="initialize();">
   <img id="guy" src = "guy.png" style="display:none;"/>
   <img id="guard" src = "guard.png" style="display:none;"/>
   <div id="container">
      <canvas id="canvas" width="900px" height="600px">
         Browser does NOT support HTML5 Canvas
      </canvas>
   </div>
   <audio id="music1" src="music.mp3"/>
   <audio id="music2" src="music2.mp3"/>
</body>

</html> 
